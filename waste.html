<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WasteWise Scanner – AI Smart Waste Sorting</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- TensorFlow.js & Teachable Machine Image Library -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f3f4f6;
      display: flex;
      justify-content: center;
    }

    .app-container {
      max-width: 800px;
      width: 100%;
      padding: 16px;
      box-sizing: border-box;
    }

    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      margin-bottom: 16px;
    }

    h1 {
      font-size: 1.8rem;
      margin: 0 0 8px;
      color: #111827;
    }

    h2 {
      font-size: 1.3rem;
      margin-bottom: 12px;
      color: #111827;
    }

    p {
      margin: 6px 0;
      color: #4b5563;
    }

    .tag {
      display: inline-block;
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: #e0f2fe;
      color: #0369a1;
      margin-right: 6px;
      margin-top: 4px;
    }

    .input-section {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .preview {
      margin-top: 10px;
      text-align: center;
    }

    #preview-image {
      max-width: 100%;
      max-height: 260px;
      border-radius: 12px;
      object-fit: contain;
      display: none;
      border: 1px solid #e5e7eb;
    }

    .buttons {
      margin-top: 12px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      padding: 10px 16px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 500;
      background: #16a34a;
      color: #ffffff;
    }

    button.secondary {
      background: #e5e7eb;
      color: #111827;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .status {
      margin-top: 8px;
      font-size: 0.9rem;
      color: #6b7280;
    }

    .result-section {
      margin-top: 10px;
      border-top: 1px solid #e5e7eb;
      padding-top: 10px;
    }

    .result-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      margin-right: 6px;
      margin-bottom: 4px;
      color: #ffffff;
    }

    .badge.blue { background: #2563eb; }
    .badge.green { background: #16a34a; }
    .badge.red { background: #dc2626; }
    .badge.gray { background: #6b7280; }
    .badge.yellow { background: #ca8a04; }

    .prob {
      font-size: 0.9rem;
      color: #4b5563;
      margin-bottom: 4px;
    }

    .eco-tip {
      background: #ecfdf3;
      border-radius: 12px;
      padding: 8px 10px;
      font-size: 0.9rem;
      color: #166534;
      margin-top: 6px;
    }

    .footer {
      text-align: center;
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 10px;
    }

    @media (max-width: 640px) {
      h1 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <div class="card">
      <h1>WasteWise Scanner</h1>
      <p>AI-based smart waste sorting assistant that helps you choose the right bin using just a photo.</p>
      <div>
        <span class="tag">SDG 11</span>
        <span class="tag">SDG 12</span>
        <span class="tag">SDG 13</span>
      </div>
      <p style="margin-top:8px;font-size:0.9rem;">
        Created by: <strong>ANANYA YADAV </strong> · School: <strong>Delhi Public School Sirsa</strong>
      </p>
    </div>

    <!-- Scanner Card -->
    <div class="card">
      <h2>1. Scan Your Waste</h2>
      <p>Select or capture an image of the item you want to throw away.</p>

      <div class="input-section">
        <input type="file" id="image-input" accept="image/*" />
        <div class="preview">
          <img id="preview-image" alt="Preview will appear here" />
        </div>

        <div class="buttons">
          <button id="scan-button" disabled>Scan Waste with AI</button>
          <button id="clear-button" class="secondary">Clear</button>
        </div>

        <div id="status" class="status">Loading AI model… please wait.</div>
      </div>

      <div id="result" class="result-section" style="display:none;">
        <div class="result-title">Result</div>
        <div id="result-category"></div>
        <div id="result-bin"></div>
        <div id="result-probability" class="prob"></div>
        <div id="result-tip" class="eco-tip"></div>
      </div>
    </div>

    <!-- Info Card -->
    <div class="card">
      <h2>2. How it Works</h2>
      <p style="font-size:0.9rem;">
        This prototype uses an image classification model trained in <strong>Teachable Machine</strong>.
        It predicts whether the item is <strong>Recyclable</strong>, <strong>Organic</strong>,
        <strong>General Waste</strong>, or <strong>E-Waste</strong>, then suggests the correct bin
        and a short eco-tip.
      </p>
      <p style="font-size:0.85rem;">
        In the final version, this can be integrated into a mobile app for households, schools, and communities.
      </p>
    </div>

    <div class="footer">
      WasteWise Scanner · EcoInnovators Ideathon 2026 Prototype
    </div>
  </div>

  <script>
    // TODO: IMPORTANT – paste your Teachable Machine model URL here
    // Example: const MODEL_BASE_URL = "https://teachablemachine.withgoogle.com/models/XXXXXXXXX/";
    const MODEL_BASE_URL = "https://teachablemachine.withgoogle.com/models/MMWdfkB47/"; // <--- CHANGE THIS

    let model;
    let maxPredictions = 0;
    let modelLoaded = false;

    const imageInput = document.getElementById("image-input");
    const previewImage = document.getElementById("preview-image");
    const scanButton = document.getElementById("scan-button");
    const clearButton = document.getElementById("clear-button");
    const statusEl = document.getElementById("status");

    const resultSection = document.getElementById("result");
    const resultCategoryEl = document.getElementById("result-category");
    const resultBinEl = document.getElementById("result-bin");
    const resultProbEl = document.getElementById("result-probability");
    const resultTipEl = document.getElementById("result-tip");

    // Map category to bin & tips
    const CATEGORY_INFO = {
      "Recyclable": {
        binLabel: "Blue Bin – Dry/Recyclable Waste",
        binClass: "blue",
        tip: "Rinse and dry this item before putting it into the blue bin. Try to avoid single-use plastics when possible."
      },
      "Organic": {
        binLabel: "Green Bin – Organic/Biodegradable Waste",
        binClass: "green",
        tip: "This can be composted. Keep it separate from plastic and metal so it can decompose naturally."
      },
      "General Waste": {
        binLabel: "Gray/Black Bin – General Waste",
        binClass: "gray",
        tip: "Reduce this type of waste by choosing reusable products and refusing unnecessary packaging."
      },
      "E-Waste": {
        binLabel: "Red Bin / E-Waste Collection Center",
        binClass: "red",
        tip: "Do not throw this in normal dustbins. Take it to an authorised e-waste collection center or drive."
      }
    };

    async function initModel() {
      try {
        const modelURL = MODEL_BASE_URL + "model.json";
        const metadataURL = MODEL_BASE_URL + "metadata.json";

        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();
        modelLoaded = true;

        statusEl.textContent = "AI model loaded. You can now upload an image.";
        scanButton.disabled = false;
      } catch (error) {
        console.error("Error loading model:", error);
        statusEl.textContent = "Error loading AI model. Please check your model URL.";
        modelLoaded = false;
        scanButton.disabled = true;
      }
    }

    // Load the model when the page opens
    window.addEventListener("load", initModel);

    // Handle image selection
    imageInput.addEventListener("change", function (event) {
      const file = event.target.files[0];
      if (!file) {
        previewImage.style.display = "none";
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        previewImage.src = e.target.result;
        previewImage.style.display = "block";
        resultSection.style.display = "none";
      };
      reader.readAsDataURL(file);
    });

    // Handle scanning (prediction)
    scanButton.addEventListener("click", async function () {
      if (!modelLoaded) {
        statusEl.textContent = "Model is not loaded yet. Please wait.";
        return;
      }

      if (!previewImage.src || previewImage.style.display === "none") {
        statusEl.textContent = "Please choose an image first.";
        return;
      }

      statusEl.textContent = "Analyzing your waste…";
      scanButton.disabled = true;

      try {
        const prediction = await model.predict(previewImage);

        // Find best prediction
        let best = prediction[0];
        for (let i = 1; i < prediction.length; i++) {
          if (prediction[i].probability > best.probability) {
            best = prediction[i];
          }
        }

        const category = best.className;
        const probability = (best.probability * 100).toFixed(1);

        const info = CATEGORY_INFO[category] || {
          binLabel: "Bin suggestion not available",
          binClass: "yellow",
          tip: "This item is not clearly mapped. Please check your local waste rules."
        };

        // Render result
        resultCategoryEl.innerHTML =
          '<span class="badge ' + (info.binClass || "yellow") + '">' +
          category +
          "</span>";

        resultBinEl.innerHTML =
          '<span class="badge ' + (info.binClass || "yellow") + '">' +
          info.binLabel +
          "</span>";

        resultProbEl.textContent =
          "Model confidence: " + probability + "%";

        resultTipEl.textContent = info.tip;

        resultSection.style.display = "block";
        statusEl.textContent = "Scan complete. Scroll to see the result.";
      } catch (error) {
        console.error("Prediction error:", error);
        statusEl.textContent = "There was an error while analyzing the image.";
      } finally {
        scanButton.disabled = false;
      }
    });

    // Clear everything
    clearButton.addEventListener("click", function () {
      imageInput.value = "";
      previewImage.src = "";
      previewImage.style.display = "none";
      resultSection.style.display = "none";
      statusEl.textContent = modelLoaded
        ? "AI model loaded. You can upload a new image."
        : "Loading AI model… please wait.";
    });
  </script>
</body>
</html>
